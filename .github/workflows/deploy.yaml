#TODO проверить, что эта штука работает вообще

name: Deploy on Server

on:
  push:
    branches: [master]
  pull_request:
    types: [closed]
    branches: [master]


jobs:
  deploy:
    if: github.event.pull_request.merged == true || github.event_name == 'push'
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Deploy to server
        uses: appleboy/ssh-action@v1
        with:
          host: ${{secrets.SERVER_HOST}}
          username: ${{secrets.SERVER_USER}}
          key: ${{secrets.SERVER_SSH_KEY}}
          script: |
            cd /root/tagallbot
            systemctl stop bot.service
            git checkout master
            git pull
            systemctl start bot.service
            cd ~
